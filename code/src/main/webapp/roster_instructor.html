<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
  <meta charset="utf-8">
  <title>Roster (Instructor)</title>

  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <link rel="stylesheet" href="css/styles.css">
  <link rel="stylesheet" href="css/roster_instructor.css">
</head>

<script>
function populatePage(){
	var data = JSON.parse(sessionStorage.getItem("result"));
	
	var courseString = data.courseList;
	
	var coursesArray = courseString.split(","); 
	
	var target = document.getElementById("accordionExample");
	console.log(target);
	
	for(var courseNum = 0; courseNum < coursesArray.length; courseNum++)
	{
		if(courseArray == "") continue;
		var courseArray = coursesArray[courseNum].split("_");
		var courseName = courseArray[0];
		var courseID = courseArray[1];
		
		 target.innerHTML = target.innerHTML +  
			`
			<div class="card">
	              <div class="card-header" id="course${courseNum+1}">
	                <h5 class="mb-0">
	                  <button class="btn nav-btn collapsed" type="button" data-toggle="collapse" data-target="#collapse${courseNum+1}">
	                    ${courseName}
	                  </button>
	                </h5>
	              </div>
	              <div id="collapse${courseNum+1}" class="collapse" data-parent="#accordionExample">
	                <div class="card-body">
	                  <button class="btn btn-light util-btns" onclick = "return goToDashboard('${coursesArray[courseNum]}')">Go to Course Dashboard</button>
	                  <button class="btn btn-primary util-btns" onclick = "return startLecture('${coursesArray[courseNum]}')">Start Lecture</button>
	                </div>
	              </div>
	            </div>
			`;	
	}
}

function goToDashboard(courseName){
	var data = JSON.parse(sessionStorage.getItem("result"));
	
	//store things in the session object here.
	
	window.location.href = "dashboard_instructor.html";
}

function startLecture(courseInfo)
{
	//courseInfo = coursename_courseID
	var cArray = courseInfo.split("_");
	var courseName = cArray[0];
	var courseID = cArray[1];
	
	
	//generate location data for user
	var latitude;
	var longitude;
	var accuracy;
	
	function success(pos){
		var crd = pos.coords;
		latitude = crd.latitude;
		longitude = crd.longitude;
		accuracy = crd.accuracy;
		console.log(crd);
	}
	
	function error(err){
		console.warn(`ERROR(${err.code}): ${err.message}`);
	}
	
	var options = {
			enableHighAccuracy: true,
			timeout: 5000,
			maximumAge: 0
		};
	
	navigator.geolocation.getCurrentPosition(success, error, options);
	
	//generate random 6 digit number
	var checkInCode = Math.floor(Math.random()*1000000);
	
	var para = "keyword="+checkInCode+ "&rating=0&courseID=" + courseID 
	+ "&latitude=" + latitude + "&longitude=" + longitude
	+ "&accuracy=" + accuracy;
	
	console.log(para);
	
	var xhttp = new XMLHttpRequest();
	xhttp.onreadystatechange = function (){
  		if (xhttp.readyState === xhttp.DONE) {
  	        if (xhttp.status === 200) {
  	     		
  	        	
  	        }
  		}
	}	
	
	xhttp.open("POST", "/Channel?method=checkIn");// syn communication
  	xhttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded", false);
  	xhttp.send(para); // Make sure to stringify*/

	
	populateQuestions(courseInfo);
}

function populateQuestions(courseInfo){
	
	//courseInfo = coursename_courseID
	
	
	
	

	
	var courseInfoArray = courseInfo.split("_");
	
	var courseID = courseInfoArray[1];
	
	
	var xhttp = new XMLHttpRequest();
	
     var para = "courseID="+courseID;
	 var status = false;
	
	 
 	 xhttp.onreadystatechange = function (){
 		if (xhttp.readyState === xhttp.DONE) {
 	        if (xhttp.status === 200) {
 	        	 
 	        	
 	        	
 	        	//format
 	        	// Questioncontent:-(upvote count:-)
 	        	var questionData = xhttp.responseText;
 	        	var questionObjArray = questionData.split(":-)");
 	        	
 	        	var target = document.getElementById("questions-box");
 	        	target.innerHTML = "";
 	        	
 	        	for(var i = 0; i < questionObjArray.length; i++)
 	        	{
 	        		if(questionObjArray[i] == "")continue;
 	        		
 	        		var question = questionObjArray[i].split(":-(")[0];
 	        		var upvotes = questionObjArray[i].split(":-(")[1];
 	        		
 	        		target.innerHTML = target.innerHTML + 
 	        		`
 	        		<div class="questionObj center_all">
		              <p class="questionText">
		                Question: ${question}
		              </p>
		              <h3 class = "upvote-num">+ ${upvotes}</h3>
		            </div>
 	        		`;
 	        	}
 	        	
 	        	
 	        	
 	        	
 	        	
 	        	
 	        	
 	        	
 	        }
 		}
 		 
 	 }
 	 xhttp.open("POST", "/Channel?method=getQuestionFeed");
 	 xhttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
 	 xhttp.send(para); // Make sure to stringify*/
 	 return status;
	
	
	
	
}


</script>


<body onload = "return populatePage()">
  <header>
    <button class="btn btn-secondary" onclick="location.href = 'login.html';">Sign out</button>
    <img class="logo" src="imgs/rosterLogo.png" alt="logo">
  </header>

  <div class="content_box">

    <div class="row fillScreen">
      <div class="nav nav-box col-2">
        <div class="nav-btns">
          <button class="btn btn-light nav-util-btn" data-toggle="modal" data-target="#addClassModal">Add Class</button>

          <!-- Modal for add class  -->
          <div class="modal fade" id="addClassModal">
            <div class="modal-dialog" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="addClassModalLabel">Add Class</h5>
                  <button type="button" class="close" data-dismiss="modal">
                    &times;
                  </button>
                </div>
                <div class="modal-body text-left">
                  <form class="" action="" method="post">
                    <div class="form-group">
                      <label for="addClassName">Course Name</label>
                      <input type="text" class="form-control" id="addClassName" placeholder="(e.g. CSCI270, HIST104)">
                    </div>
                    <div class="form-group">
                      <label for="lectureTime">Lecture Time</label>
                      <input type="text" class="form-control" id="lectureTime" aria-describedby="graceDaysHelp" placeholder="(e.g. 10:00 AM, 3:50PM)">
                    </div>
                    <div class="form-group">
                      <label for="numGraceDays">Grace Days</label>
                      <input type="text" class="form-control" id="numGraceDays" aria-describedby="graceDaysHelp" placeholder="(e.g. 0, 1, 5)">
                      <small id="graceDaysHelp" class="form-text text-muted">Give students attendance forgiveness for some number of days.</small>
                    </div>
                    <button type="submit" class="btn btn-primary">Add Class</button>
                  </form>
                </div>
              </div>
            </div>
          </div>




          <button class="btn btn-light nav-util-btn" data-toggle="modal" data-target="#delClassModal">Delete Class</button>

          <!-- Modal for add class  -->
          <div class="modal fade" id="delClassModal">
            <div class="modal-dialog" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="delClassModalLabel">Delete Class</h5>
                  <button type="button" class="close" data-dismiss="modal">
                    &times;
                  </button>
                </div>
                <div class="modal-body text-left">
                  <form class="" action="" method="post">

                    <div class="form-check">
                      <input class="form-check-input" type="radio" name="exampleRadios" id="exampleRadios1" value="option1" checked>
                      <label class="form-check-label" for="exampleRadios1">
                        Course 1
                      </label>
                    </div>

                    <div class="form-check">
                      <input class="form-check-input" type="radio" name="exampleRadios" id="exampleRadios1" value="option1" checked>
                      <label class="form-check-label" for="exampleRadios1">
                        Course 2
                      </label>
                    </div>

                    <div class="form-check">
                      <input class="form-check-input" type="radio" name="exampleRadios" id="exampleRadios1" value="option1" checked>
                      <label class="form-check-label" for="exampleRadios1">
                        Course 3
                      </label>
                    </div>

                    <div class="alert alert-warning">Warning: You can't undo this action. Please be careful!</div>
                    <button type="submit" class="btn btn-danger">Delete Class Forever</button>
                  </form>
                </div>
              </div>
            </div>
          </div>


        </div>


        <div class="nav-content">
          <div class="accordion" id="accordionExample">
            <div class="card">
              <div class="card-header" id="headingOne">
                <h5 class="mb-0">
                  <button class="btn nav-btn" type="button" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                    CSCI 270 - 1:00 PM
                  </button>
                </h5>
              </div>

              <div id="collapseOne" class="collapse" aria-labelledby="headingOne" data-parent="#accordionExample">
                <div class="card-body">
                  <button class="btn btn-light util-btns">Go to Course Dashboard</button>
                  <button class="btn btn-primary util-btns">Start Lecture</button>
                </div>
              </div>
            </div>
            <div class="card">
              <div class="card-header" id="headingTwo">
                <h5 class="mb-0">
                  <button class="btn nav-btn collapsed" type="button" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                    CSCI 270 - 4:00 PM
                  </button>
                </h5>
              </div>
              <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordionExample">
                <div class="card-body">
                  <button class="btn btn-light util-btns">Go to Course Dashboard</button>
                  <button class="btn btn-primary util-btns">Start Lecture</button>
                </div>
              </div>
            </div>
            <div class="card">
              <div class="card-header" id="headingThree">
                <h5 class="mb-0">
                  <button class="btn nav-btn collapsed" type="button" data-toggle="collapse" data-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                    CSCI 103 - 9:00 AM
                  </button>
                </h5>
              </div>
              <div id="collapseThree" class="collapse" aria-labelledby="headingThree" data-parent="#accordionExample">
                <div class="card-body">
                  <button class="btn btn-light util-btns">Go to Course Dashboard</button>
                  <button class="btn btn-primary util-btns">Start Lecture</button>
                </div>
              </div>
            </div>
          </div>





        </div>
      </div>

      <div class="col-10">
        <div class="main-content">

          <h1 id = "courseName">Course Name - Course Time</h1>

          <h4>Student Questions</h4>


          <div id = "questions-box" class="questions-box">

            <div class="questionObj center_all">
              <p class="questionText">
                Question: Lorem ipsum dolor
              </p>
              <h3 class = "upvote-num">+144</h3>
            </div>

            <div class="questionObj center_all">
              <p class="questionText">
                Question: Lorem ipsum dolor
              </p>
              <h3 class = "upvote-num">+64</h3>
            </div>

            <div class="questionObj center_all">
              <p class="questionText">
                Question: Lorem ipsum dolor
              </p>
              <h3 class = "upvote-num">+54</h3>
            </div>
            <div class="questionObj center_all">
              <p class="questionText">
                Question: Lorem ipsum dolor
              </p>
              <h3 class = "upvote-num">+40</h3>
            </div>
            <div class="questionObj center_all">
              <p class="questionText">
                Question: Lorem ipsum dolor
              </p>
              <h3 class = "upvote-num">+40</h3>
            </div>
            <div class="questionObj center_all">
              <p class="questionText">
                Question: Lorem ipsum dolor
              </p>
              <h3 class = "upvote-num">+34</h3>
            </div>
            <div class="questionObj center_all">
              <p class="questionText">
                Question: Lorem ipsum dolor
              </p>
              <h3 class = "upvote-num">+24</h3>
            </div>
            <div class="questionObj center_all">
              <p class="questionText">
                Question: Lorem ipsum dolor
              </p>
              <h3 class = "upvote-num">+11</h3>
            </div>
            <div class="questionObj center_all">
              <p class="questionText">
                Question: Lorem ipsum dolor
              </p>
              <h3 class = "upvote-num">+3</h3>
            </div>
            <div class="questionObj center_all">
              <p class="questionText">
                Question: Lorem ipsum dolor
              </p>
              <h3 class = "upvote-num">+1</h3>
            </div>
            <div class="questionObj center_all">
              <p class="questionText">
                Question: Lorem ipsum dolor
              </p>
              <h3 class = "upvote-num">+1</h3>
            </div>
            <div class="questionObj center_all">
              <p class="questionText">
                Question: Lorem ipsum dolor
              </p>
              <h3 class = "upvote-num">+1</h3>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>


  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
</body>

</html>
